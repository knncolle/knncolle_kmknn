<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>knncolle_kmknn: knncolle bindings for KMKNN</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">knncolle_kmknn
   </div>
   <div id="projectbrief">KMKNN in knncolle</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">knncolle bindings for KMKNN </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a></p>
<p><img src="https://github.com/knncolle/knncolle_kmknn/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/knncolle/knncolle_kmknn/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/knncolle/knncolle_kmknn"><img src="https://codecov.io/gh/knncolle/knncolle_kmknn/branch/master/graph/badge.svg" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>This library implements the <a href="https://doi.org/10.1109/IJCNN.2011.6033373">k-means for k-nearest neighbors (KMKNN)</a> algorithm for an exact neighbor search. The idea is to apply k-means clustering on the input dataset, and then use the distances to the cluster centroids to narrow the search space for neighbors of an observation of interest. This is an exact nearest neighbor search that is also capable of finding all neighbors within a threshold distance. Users can easily swap in KMKNN in any framework that accepts <a href="https://github.com/knncolle/knncolle"><b>knncolle</b></a> interfaces.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Quick start</h1>
<p>Instances of the various <b>`knncolle_kmknn</b> classes can be used anywhere that accepts the corresponding <b>knncolle</b> interface. For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;knncolle/knncolle_kmknn.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ndim = 10;</div>
<div class="line"><span class="keywordtype">int</span> nobs = 1000;</div>
<div class="line">std::vector&lt;double&gt; matrix(ndim * nobs); <span class="comment">// column-major ndim x nobs matrix.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wrap our data in a light SimpleMatrix.</span></div>
<div class="line"><a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix&lt;int, double&gt;</a> mat(ndim, nobs, matrix.data());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Build an KMKNN index. </span></div>
<div class="line"><span class="keyword">auto</span> dist = std::make_shared&lt;knncolle_kmknn::EuclideanDistance&lt;double, double&gt; &gt;();</div>
<div class="line"><a class="code hl_class" href="classknncolle__kmknn_1_1KmknnBuilder.html">knncolle_kmknn::KmknnBuilder&lt;int, double, double&gt;</a> kbuilder(dist);</div>
<div class="line"><span class="keyword">auto</span> kindex = kbuilder.build_unique(mat);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Find 10 nearest neighbors of every element.</span></div>
<div class="line"><span class="keyword">auto</span> results = <a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a2c6d8b116464bab254bda34216338c3c">knncolle::find_nearest_neighbors</a>(*kindex, 10); </div>
<div class="ttc" id="aclassknncolle_1_1SimpleMatrix_html"><div class="ttname"><a href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix</a></div></div>
<div class="ttc" id="aclassknncolle__kmknn_1_1KmknnBuilder_html"><div class="ttname"><a href="classknncolle__kmknn_1_1KmknnBuilder.html">knncolle_kmknn::KmknnBuilder</a></div><div class="ttdoc">Perform a nearest neighbor search based on k-means clustering.</div><div class="ttdef"><b>Definition</b> knncolle_kmknn.hpp:687</div></div>
<div class="ttc" id="anamespaceknncolle_html_a2c6d8b116464bab254bda34216338c3c"><div class="ttname"><a href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a2c6d8b116464bab254bda34216338c3c">knncolle::find_nearest_neighbors</a></div><div class="ttdeci">NeighborList&lt; Index_, Distance_ &gt; find_nearest_neighbors(const Prebuilt&lt; Index_, Data_, Distance_ &gt; &amp;index, int k, int num_threads=1)</div></div>
</div><!-- fragment --><p>Check out the <a href="https://knncolle.github.io/knncolle_kmknn/">reference documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Customizing the search</h1>
<p>We can customize the behavior of the <code>KmknnBuilder</code> by modifying some of its options. For example, to modify the k-means clustering:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span>&amp; opt = kbuilder.get_options();</div>
<div class="line">opt.initialize_algorithm.reset(<span class="keyword">new</span> <a class="code hl_classRef" href="https://ltla.github.io/CppKmeans/classkmeans_1_1InitializeRandom.html">knncolle_kmknn::InitializeRandom&lt;int, double, double&gt;</a>);</div>
<div class="line">opt.refine_algorithm.reset(<span class="keyword">new</span> <a class="code hl_classRef" href="https://ltla.github.io/CppKmeans/classkmeans_1_1RefineLloyd.html">knncolle_kmknn::RefineLloyd&lt;int, double, double&gt;</a>);</div>
<div class="line"><span class="keyword">auto</span> kindex2 = kbuilder.build_unique(mat);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Alternatively we can pass some options directly to the KmknnBuilder&#39;s constructor.</span></div>
<div class="line"><a class="code hl_struct" href="structknncolle__kmknn_1_1KmknnOptions.html">knncolle_kmknn::KmknnOptions&lt;int, double, double&gt;</a> new_options;</div>
<div class="line">new_options.<a class="code hl_variable" href="structknncolle__kmknn_1_1KmknnOptions.html#a84b020741aac4160fed42a291d054216">power</a> = 0.8;</div>
<div class="line"><a class="code hl_class" href="classknncolle__kmknn_1_1KmknnBuilder.html">knncolle_kmknn::KmknnBuilder&lt;int, double, double&gt;</a> kbuilder(dist, new_options);</div>
<div class="ttc" id="aclasskmeans_1_1InitializeRandom_html"><div class="ttname"><a href="https://ltla.github.io/CppKmeans/classkmeans_1_1InitializeRandom.html">kmeans::InitializeRandom</a></div></div>
<div class="ttc" id="aclasskmeans_1_1RefineLloyd_html"><div class="ttname"><a href="https://ltla.github.io/CppKmeans/classkmeans_1_1RefineLloyd.html">kmeans::RefineLloyd</a></div></div>
<div class="ttc" id="astructknncolle__kmknn_1_1KmknnOptions_html"><div class="ttname"><a href="structknncolle__kmknn_1_1KmknnOptions.html">knncolle_kmknn::KmknnOptions</a></div><div class="ttdoc">Options for KmknnBuilder construction.</div><div class="ttdef"><b>Definition</b> knncolle_kmknn.hpp:184</div></div>
<div class="ttc" id="astructknncolle__kmknn_1_1KmknnOptions_html_a84b020741aac4160fed42a291d054216"><div class="ttname"><a href="structknncolle__kmknn_1_1KmknnOptions.html#a84b020741aac4160fed42a291d054216">knncolle_kmknn::KmknnOptions::power</a></div><div class="ttdeci">double power</div><div class="ttdef"><b>Definition</b> knncolle_kmknn.hpp:189</div></div>
</div><!-- fragment --><p>We can also pass in a different distance metric, if so desired. KMKNN works most naturally with the Euclidean distance as k-means aims to minimize the Euclidean distance between data points and the centroids. But a different distance metric will still give the correct results:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> man_dist = std::make_shared&lt;knncolle_kmknn::ManhattanDistance&lt;double, double&gt; &gt;();</div>
<div class="line"><a class="code hl_class" href="classknncolle__kmknn_1_1KmknnBuilder.html">knncolle_kmknn::KmknnBuilder&lt;int, double, double&gt;</a> man_kbuilder(man_dist);</div>
</div><!-- fragment --><p>As with other <b>knncolle</b> classes, advanced users can choose their own types via different template parametrizations. This may provide some opportunities for devirtualization if polymorphism is not required.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classknncolle__kmknn_1_1KmknnBuilder.html">knncolle_kmknn::KmknnBuilder</a>&lt;</div>
<div class="line">    <span class="comment">/* observation index */</span> size_t,</div>
<div class="line">    <span class="comment">/* input data type */</span> float,</div>
<div class="line">    <span class="comment">/* distance type */</span> double,</div>
<div class="line">    <span class="comment">/* input matrix representation */</span> <a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix&lt;size_t, float&gt;</a>,</div>
<div class="line">    <span class="comment">/* distance metric */</span> <a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1EuclideanDistance.html">knncolle_kmknn::EuclideanDistance&lt;double, double&gt;</a></div>
<div class="line">&gt; kbuilder_typed(dist);</div>
<div class="ttc" id="aclassknncolle_1_1EuclideanDistance_html"><div class="ttname"><a href="https://knncolle.github.io/knncolle/classknncolle_1_1EuclideanDistance.html">knncolle::EuclideanDistance</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Building projects</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
CMake with <code>FetchContent</code></h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  knncolle</div>
<div class="line">  GIT_REPOSITORY https://github.com/knncolle/knncolle_kmknn</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(knncolle_kmknn)</div>
</div><!-- fragment --><p>Then you can link to <b><a class="el" href="namespaceknncolle__kmknn.html" title="Namespace for the knncolle_kmeans library.">knncolle_kmknn</a></b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe knncolle::knncolle_kmknn)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE knncolle::knncolle_kmknn)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
CMake with <code>find_package()</code></h2>
<div class="fragment"><div class="line">find_package(knncolle_knncolle_kmknn CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE knncolle::knncolle_kmknn)</div>
</div><!-- fragment --><p>To install the library, use:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DKNNCOLLE_KMKNN_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>By default, this will use <code>FetchContent</code> to fetch all external dependencies. If you want to install them manually, use <code>-DKNNCOLLE_KMKNN_FETCH_EXTERN=OFF</code>. See <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> to find compatible versions of each dependency.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files in <code>include/</code> - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. See <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> for the required external dependencies. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
